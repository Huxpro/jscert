* Migrating data from mysql to PostgreSQL

  Do the following to get a DB dump

#+begin_src sh
  sqlite3 gds.db .dump > /media/bigdata/DBPlay/gds.dbdump
#+end_src

  Various things need changing before PostgreSQL will be happy with it.

#+begin_src emacs-lisp
  (defun jscert/kill-lines-containing (pattern)
    "In the current buffer, kill all lines containing PATTERN."
    (interactive "sKill lines containing: ")
    (save-excursion
      (beginning-of-buffer)
      (while (search-forward pattern)
        (beginning-of-line)
        (let ((beg (point)))
          (end-of-line)
          (forward-char)
          (delete-region beg (point))))))
  
  (defun jscert/jscert-db-transform ()
    "Transform a SQLite JSCert DB dump into something we can read into PostgreSQL."
    (save-excursion
      (beginning-of-buffer)
      (replace-string "PRAGMA foreign_keys=OFF;
  " "")
      (beginning-of-buffer)
      (replace-string "'True'" "TRUE")
      (beginning-of-buffer)
      (replace-string "'False'" "FALSE")
      (beginning-of-buffer)
      (replace-string "negative integer"  "negative boolean")
      (beginning-of-buffer)
      (replace-string "test_id integer references test_cases(filepath)" "test_id TEXT references test_cases(filepath)")
      (beginning-of-buffer)
      (replace-string "autoincrement" "SERIAL")
      (beginning-of-buffer)
      (replace-string "integer primary key SERIAL" "SERIAL PRIMARY KEY")
      (jscert/kill-lines-containing "SpiderMonkey")
      (jscert/kill-lines-containing "tests/more-tests"))
    (save-excursion
      (beginning-of-buffer)
      (search-forward "CREATE TABLE test_groups (")
      (beginning-of-line)
      (let ((beg (point)))
        (end-of-line)
        (search-forward "CREATE TABLE")
        (beginning-of-line)
        (kill-region beg (point))
        (beginning-of-buffer)
        (search-forward "CREATE TABLE")
        (beginning-of-line)
        (yank))))
#+end_src

  Then dump it into psql:

#+begin_src sh
      psql -f gds.dbdump -h ec2-75-101-167-151.compute-1.amazonaws.com -d ddgkhduqenb3vg -U cshutvvmqmlvxn -p 5432
#+end_src
